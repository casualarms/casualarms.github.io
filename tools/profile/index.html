---
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Profile Creator - Casual ARMS</title>
    {% include meta_tags.html %}
    <link rel="stylesheet" href="/assets/style.css">

    <style>
      #container {
	  text-align: center;
      }

      #command-output-container {
	  text-align: center;
      }
    </style>

    <script type="text/javascript" src="/script/arms-data.js"></script>

    <script type="text/javascript">
      /*
       * FIXME: copypasta'd this from the randomizer... probably ought to
       * arrange for both places to share a single source...
       */
      function makeID(text) {
	  return text.replace(/[\[\]\&\s\.]/g, '').toLowerCase();
      }

      /* FIXME: minimal error checking! */
      function fillFormFromHistory()
      {
	  var rawHistory = document.getElementById("history-input").value;
	  var history = JSON.parse(rawHistory);

	  /* Handle friend-code specially */
	  var fcMatch = history["fc"].match(/(\d{4})-(\d{4})-(\d{4})/);

	  if (fcMatch)
	      for (var i = 1; i < 4; i++)
		  document.getElementById("friend-code-" + i).value = fcMatch[i];

	  delete history["fc"];

	  for (const key in history)
	      document.getElementById(key).value = history[key];
      }

      function generateCommandOutput()
      {
	  var output = {};

	  Array.from(document.getElementsByTagName("input")).map(
	      function (x) {
		  output[x.id] = x.value;
	      }
	  );

	  Array.from(document.getElementsByTagName("select")).map(
	      function (x) {
		  output[x.id] = x.value;
	      }
	  );

	  output["one-liner"] = document.getElementById("one-liner").value;

	  output["fc"] = output["friend-code-1"] +
	      "-" + output["friend-code-2"] +
	      "-" + output["friend-code-3"];

	  delete output["friend-code-1"];
	  delete output["friend-code-2"];
	  delete output["friend-code-3"];

	  document.getElementById("command-output").value = "!profile-update " + JSON.stringify(output);

	  return JSON.stringify(output);
      }

      function generateCharacterSelectors()
      {
	  var armsMainSelector = document.getElementById("arms-main");

	  armsMainSelector.innerHTML = "<option value=\"none\">---</option>";

	  fighterStats.forEach(
	      function (value, _, _) {
		  fighter = value[0];
		  armsMainSelector.innerHTML += "<option value=\"" +
		      makeID(fighter) + "\">" + fighter + "</option>";
	      }
	  );

	  var armsSecondarySelector = document.getElementById("arms-secondary");

	  armsSecondarySelector.innerHTML = "<option value=\"none\">---</option>";

	  fighterStats.forEach(
	      function (value, _, _) {
		  fighter = value[0];
		  armsSecondarySelector.innerHTML += "<option value=\"" +
		      makeID(fighter) + "\">" + fighter + "</option>";
	      }
	  );
      }

      function pageload()
      {
	  generateCharacterSelectors();
      }
    </script>
  </head>
  <body onload="pageload();">
    <h1>Casual ARMS Profile Creator</h1>
    <div id="container">
      <div id="history-input-container" style="white-space: pre-line">
	Paste the data Itembot gave you here:
	<textarea id="history-input" cols="80" rows="10"></textarea>
	<button type="button" onclick="fillFormFromHistory();">Fill Form From Data</button>
      </div>

      <span id="full-name-container">
	<label for="full-name">Name:</label>
	<input type="text" id="full-name">
      </span>
      <span id="switch-name-container">
	<label for="switch-name">Switch Name:</label>
	<input type="text" id="switch-name">
      </span>

      <div id="fc-container">
	<label>Friend Code:</label>
	SW-
	<input id="friend-code-1" type="tel" pattern="\d{4}" maxlength="4" size="4">
	-
	<input id="friend-code-2" type="tel" pattern="\d{4}" maxlength="4" size="4">
	-
	<input id="friend-code-3" type="tel" pattern="\d{4}" maxlength="4" size="4">
      </div>

      <span id="arms-main-container">
	<label for="arms-main">ARMS Main:</label>
	<select id="arms-main">
	  <!-- Generated by JavaScript -->
	</select>
      </span>

      <span id="arms-secondary-container">
	<label for="arms-secondary">ARMS Secondary:</label>
	<select id="arms-secondary">
	  <!-- Generated by JavaScript -->
	</select>
      </span>

      <div id="one-liner-container">
	<label for="one-liner">One liner/saying:</label>
	<textarea id="one-liner" cols="40" rows="2"></textarea>
      </div>

      <div id="command-output-container" style="white-space: pre-line">
	<button type="button" onclick="generateCommandOutput();">Generate Command Output</button>
	Send this command to Itembot:
	<textarea id="command-output" cols="80" rows="10" readonly></textarea>
      </div>
    </div>
  </body>
</html>
